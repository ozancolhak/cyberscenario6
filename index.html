<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Scenario V6: Bulut Güvenliği Kriz Simülasyonu</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/dracula.min.css">
    <style>
        :root {
            --dark-bg: #1a1a2e;
            --container-bg: #2a2a4a;
            --section-bg: #333355;
            --interactive-bg: #444466;
            --accent-blue: #8be9fd;
            --accent-purple: #bd93f9;
            --accent-pink: #ff79c6;
            --accent-green: #50fa7b;
            --accent-yellow: #f1fa8c;
            --accent-red: #ff5555;
            --text-light: #e0e0e0;
            --text-dark: #282a36;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: var(--dark-bg); 
            color: var(--text-light); 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            min-height: 100vh;
            font-size: 0.95em; 
        }

        .container { 
            background-color: var(--container-bg); 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            padding: 20px; 
            max-width: 950px; 
            width: 100%; 
            margin: 40px 0; 
        }

        @media (min-width: 768px) { .container { padding: 40px; } }

        .centered-page { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            min-height: 60vh; 
            animation: fadeIn 0.5s ease-out; 
        }

        h1 { font-size: 2.4em; color: var(--accent-blue); margin-bottom: 20px; }
        h2 { font-size: 1.9em; color: var(--accent-blue); border-bottom: 2px solid var(--interactive-bg); padding-bottom: 15px; margin-bottom: 25px; text-align: left; }
        h3 { font-size: 1.5em; color: var(--accent-purple); text-align: left; margin-top: 25px; margin-bottom: 15px; }
        h4 { font-size: 1.1em; color: var(--accent-yellow); text-align: left; margin-top: 0; border-bottom: 1px solid var(--interactive-bg); padding-bottom: 10px; }
        p { line-height: 1.7; font-size: 1em; }

        .section { display: none; padding: 20px; background-color: var(--section-bg); border-radius: 8px; margin-top: 25px; animation: fadeIn 0.5s ease-out; }
        @media (min-width: 768px) { .section { padding: 30px; } }

        .interactive-element { background-color: var(--interactive-bg); border-radius: 8px; padding: 20px; margin-top: 20px; }
        .decision-buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .btn { background-color: #6272a4; color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; font-size: 1.1em; transition: all 0.3s ease; text-align: left; display: flex; align-items: center; gap: 15px; font-weight: 700; }
        .btn:hover { background-color: #7a8ab9; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn:disabled { background-color: #555 !important; color: #999 !important; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .btn .btn-text { flex-grow: 1; }
        .btn small { display: block; font-size: 0.85em; opacity: 0.8; margin-top: 5px; font-weight: 400; }
        .btn-start, .btn-continue { font-size: 1.3em; font-weight: bold; text-align: center; background-color: var(--accent-green); color: var(--text-dark); justify-content: center; }
        .btn.critical { background-color: var(--accent-pink); }

        #intermissionSection .metric-change { font-size: 1.2em; margin: 15px 0; display: flex; align-items: center; gap: 10px; }
        .metric-change .positive { color: var(--accent-green); }
        .metric-change .negative { color: var(--accent-red); }
        .metric-change .neutral { color: var(--accent-blue); } 

        #statusBar { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px; background-color: var(--text-dark); padding: 15px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #6272a4; }
        #statusBar .metric { text-align: center; font-size: 0.9em; flex: 1; min-width: 100px; } 
        #statusBar .metric .value { font-size: 1.3em; font-weight: bold; color: var(--accent-yellow); }

        .final-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-top: 20px; width: 100%; max-width: 850px; } 
        .metric-card { background-color: var(--section-bg); padding: 25px; border-radius: 8px; text-align: center; border: 1px solid var(--interactive-bg); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 150px; }
        .metric-card:hover { transform: scale(1.05); border-color: var(--accent-blue); }
        .metric-card .icon { font-size: 2.5em; color: var(--accent-blue); margin-bottom: 10px; }
        .metric-card .label { font-size: 1.1em; margin-bottom: 5px; color: var(--text-light); }
        .metric-card .value { font-size: 1.8em; font-weight: bold; color: var(--accent-yellow); }

        .code-block, .slack-chat { background-color: var(--text-dark); border: 1px solid #6272a4; border-radius: 8px; padding: 20px; margin-top: 15px; white-space: pre-wrap; word-break: break-all; font-family: 'Consolas', monospace; }
        .learning-note { background-color: var(--text-dark); border-left: 5px solid var(--accent-blue); padding: 20px; border-radius: 8px; margin-top: 30px; }
        .scenario-image { width: 100%; max-width: 500px; margin: 25px auto; display: block; border-radius: 8px; border: 1px solid var(--interactive-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .slack-chat .message { margin-bottom: 10px; padding: 8px; border-radius: 5px; background-color: #3f3f5a; }
        .slack-chat .sender { font-weight: bold; color: var(--accent-pink); }
        .slack-chat .sender.cso { color: var(--accent-green); }
        .slack-chat .sender.ops { color: var(--accent-yellow); }
        .slack-chat .sender.legal { color: var(--accent-blue); }
        .slack-chat .sender.ceo { color: var(--accent-purple); }
        .slack-chat .sender.cto { color: var(--accent-green); } 
        .slack-chat .sender.pr { color: var(--accent-pink); } 
        .slack-chat .sender.finance { color: var(--accent-red); } 
        .suspect-card { background-color: var(--interactive-bg); border-radius: 8px; padding: 15px; margin-bottom: 10px; border-left: 5px solid var(--accent-purple); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .suspect-card h4 { margin-top: 0; margin-bottom: 5px; border-bottom: none; color: var(--accent-purple); }

        /* === FİNAL SAYFASI STİLLERİ === */
        #finalSection { text-align: center; }
        #performance-badge-container { margin: 25px 0; }
        #performance-badge { padding: 12px 30px; font-size: 1.8em; font-weight: bold; border-radius: 50px; display: inline-block; color: var(--text-dark); box-shadow: 0 5px 20px rgba(0,0,0,0.4); transition: transform 0.3s ease; }
        #performance-badge:hover { transform: scale(1.05); }
        .post-crisis-layout { display: grid; grid-template-columns: 1fr; gap: 30px; text-align: left; margin-top: 40px; width: 100%; }
        @media (min-width: 800px) { .post-crisis-layout { grid-template-columns: 1fr 1fr; } }
        .event-timeline, .strategic-debrief { background-color: var(--interactive-bg); padding: 25px; border-radius: 8px; border: 1px solid var(--section-bg); margin-top: 20px; }
        .event-timeline h3, .strategic-debrief h3 { margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid var(--section-bg); color: var(--accent-blue); display: flex; align-items: center; gap: 10px; }
        .event-timeline ul { list-style-type: none; padding-left: 0; margin: 15px 0 0 0; }
        .event-timeline li { position: relative; padding: 5px 0 15px 35px; border-left: 2px solid var(--section-bg); font-size: 0.95em; }
        .event-timeline li:last-child { border-left: none; }
        .event-timeline li::before { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--accent-green); position: absolute; left: -12px; top: 5px; background-color: var(--dark-bg); width: 22px; height: 22px; border-radius: 50%; text-align: center; line-height: 22px; font-size: 0.8em; border: 2px solid var(--section-bg); }
        .event-timeline li.negative::before { content: '\f00d'; color: var(--accent-red); }
        .event-timeline li.neutral::before { content: '\f05a'; color: var(--accent-blue); }
        .event-timeline li .decision-title { font-weight: bold; color: var(--accent-purple); display: block; margin-bottom: 4px; }
        .event-timeline li .decision-impact { font-style: italic; opacity: 0.8; font-size: 0.9em; }
        #strategic-debrief-content p { font-size: 1em; margin-bottom: 15px; }
        #score-breakdown { list-style: none; padding: 0; margin-top: 15px; text-align: left; }
        #score-breakdown li { padding: 8px 12px; border-radius: 6px; margin-bottom: 8px; font-size: 1.05em; display: flex; justify-content: space-between; }
        #score-breakdown .score-plus { background-color: rgba(80, 250, 123, 0.1); border-left: 3px solid var(--accent-green); }
        #score-breakdown .score-minus { background-color: rgba(255, 85, 85, 0.1); border-left: 3px solid var(--accent-red); }
        #score-breakdown .score-neutral { background-color: rgba(139, 233, 253, 0.1); border-left: 3px solid var(--accent-blue); }
        #score-breakdown .score-value { font-weight: bold; }

        /* Roles Info specific styles */
        .intro-info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-top: 30px;
            width: 100%;
            max-width: 800px;
            text-align: left;
        }

        @media (min-width: 768px) {
            .intro-info-grid {
                grid-template-columns: 1fr 1fr; 
            }
        }

        .intro-roles-container, .intro-metrics-container {
            background-color: var(--section-bg);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 1px solid var(--interactive-bg);
        }

        .intro-roles-container h3, .intro-metrics-container h3 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--interactive-bg);
            color: var(--accent-purple);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .intro-roles-container ul, .intro-metrics-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .intro-roles-container li, .intro-metrics-container li {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px dashed var(--interactive-bg);
            font-size: 1.05em;
        }

        .intro-roles-container li:last-child, .intro-metrics-container li:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .intro-roles-container li .icon, .intro-metrics-container li .icon {
            font-size: 1.8em;
            color: var(--accent-blue);
            flex-shrink: 0;
            width: 35px;
            text-align: center;
        }
        
        .intro-roles-container li strong {
            color: var(--accent-yellow);
        }

        .intro-roles-container li small {
            display: block;
            font-size: 0.9em;
            color: var(--text-light);
            opacity: 0.8;
            margin-top: 3px;
        }
        
        /* === Liderlik tablosu (modal) — yenilenen tasarım === */
        .lb-overlay{
            display:none; position:fixed; inset:0;
            background: rgba(10,10,25,.7);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            z-index:9999; align-items:center; justify-content:center; padding:20px;
        }
        .lb-modal{
            background: linear-gradient(180deg, #2a2a4a 0%, #1f1f36 100%);
            color: var(--text-light);
            width:100%; max-width: 760px; border-radius:14px; padding:22px 22px 16px;
            border:1px solid rgba(255,255,255,.08);
            box-shadow: 0 18px 50px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04);
        }
        .lb-header{
            display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;
        }
        .lb-title{
            display:flex; align-items:center; gap:10px;
            font-size:1.25em; font-weight:800; letter-spacing:.2px; color: var(--accent-yellow);
        }
        .lb-title i{ filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); }
        .lb-sub{ font-size:.92em; opacity:.85; color:#cfd3ff; }

        .lb-tablewrap{
            margin-top:10px;
            max-height: 60vh; overflow:auto;
            border:1px solid var(--interactive-bg); border-radius:10px;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
        }

        /* Tablo */
        table.lb-table{ width:100%; border-collapse:collapse; font-size:.97em; }
        table.lb-table th, table.lb-table td{ padding:10px 12px; text-align:left; }
        table.lb-table thead th{
            position: sticky; top:0; z-index:1;
            background:#1f1f36; color:#e9e9ff;
            border-bottom: 1px solid #3b3b66;
            font-weight:700; letter-spacing:.3px;
        }
        table.lb-table tbody td{ border-bottom:1px solid rgba(255,255,255,.06); color:#e9e9f5; }
        table.lb-table tbody tr:hover{ background-color: rgba(255,255,255,.045); }

        /* İlk 3 sırayı vurgula + rozet */
        table.lb-table tbody tr:nth-child(1){
            background: linear-gradient(90deg, rgba(255,215,0,.18), transparent 65%);
        }
        table.lb-table tbody tr:nth-child(1) td:first-child::after{ content:" 🥇"; }
        table.lb-table tbody tr:nth-child(2){
            background: linear-gradient(90deg, rgba(192,192,192,.18), transparent 65%);
        }
        table.lb-table tbody tr:nth-child(2) td:first-child::after{ content:" 🥈"; }
        table.lb-table tbody tr:nth-child(3){
            background: linear-gradient(90deg, rgba(205,127,50,.18), transparent 65%);
        }
        table.lb-table tbody tr:nth-child(3) td:first-child::after{ content:" 🥉"; }

        /* Alt aksiyon butonları */
        .lb-actions{ display:flex; gap:12px; justify-content:flex-end; margin-top:14px; }
        .lb-close, .lb-refresh{
            border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:700;
            transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
        }
        .lb-refresh{ background: var(--accent-blue); color:#0c1130; }
        .lb-close{ background: #3d3d60; color:#fff; }
        .lb-refresh:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(139,233,253,.22); }
        .lb-close:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.35); }

        /* Küçük ekran iyileştirmeleri */
        @media (max-width: 420px){
          .lb-title{ font-size:1.05em; }
          table.lb-table th, table.lb-table td{ padding:9px 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="introSection" class="centered-page">
            <h1><i class="fa-solid fa-cloud-bolt"></i> Bulut Güvenliği Krizi Simülasyonu</h1>
            <p style="max-width: 600px;">Hoş geldiniz, **ÇOLHAK Teknoloji**'nin **Kıdemli Bulut Güvenliği Uzmanı**! Şirketiniz, finans sektörüne yönelik risk analiz ürününü bulut ortamında barındırıyor ve lansmana sadece 72 saat kaldı. Ancak, güvenlik ekibimiz dışarıdan gelen olağandışı veri çekme talepleri ve sızıntı raporlarıyla alarma geçmiş durumda. Bir saldırganın, korumasız bırakılmış bir veri deposu, yanlış yapılandırılmış erişim izni veya devre dışı kalmış bir güvenlik adımı üzerinden sızdığı düşünülüyor. Görevin: Bu gizli veri sızıntısını durdurmak, hasarı kontrol altına almak ve bulut altyapınızın gelecekteki dayanıklılığını sağlamak!</p>
            <img src="images/intro.png" alt="Cloud security themed intro image" class="scenario-image">

            <div class="intro-info-grid">
                <div class="intro-roles-container">
                    <h3><i class="fa-solid fa-people-arrows"></i> Simülasyon Rolleri</h3>
                    <ul>
                        <li class="your-role">
                            <span class="icon"><i class="fa-solid fa-cloud-bolt"></i></span>
                            <div>
                                <strong>Sizin Rolünüz: Kıdemli Bulut Güvenliği Uzmanı</strong> 
                                <small>Bulut altyapısının güvenliğinden sorumlusun. Teknik analizler, yanlış yapılandırmaların tespiti ve erişim izinleri gibi alanlarda aktif rol alıyorsun. Seçimlerin sonucu doğrudan etkileyecek.</small>
                            </div>
                        </li>
                        <li><span class="icon"><i class="fa-solid fa-users-gear"></i></span><div><strong>CEO Dilara Akın</strong> <small>İtibar ve medya öncelikli.</small></div></li>
                        <li><span class="icon"><i class="fa-solid fa-microchip"></i></span><div><strong>CTO Furkan Tekin</strong> <small>Teknik altyapıya hâkim, seni destekliyor.</small></div></li>
                        <li><span class="icon"><i class="fa-solid fa-user-tie"></i></span><div><strong>CISO Can Çolhak</strong> <small>Güvenlikten sorumlu, panik halinde.</small></div></li>
                        <li><span class="icon"><i class="fa-solid fa-bullhorn"></i></span><div><strong>PR Direktörü Serap Nur</strong> <small>Basın kontrolünü ister.</small></div></li>
                        <li><span class="icon"><i class="fa-solid fa-money-bill-transfer"></i></span><div><strong>Finans Direktörü Enes Mert</strong> <small>Proje iptali bütçe açısından felaket olur.</small></div></li>
                    </ul>
                </div>

                <div class="intro-metrics-container">
                    <h3><i class="fa-solid fa-chart-line"></i> Temel Metrikler</h3>
                    <ul>
                        <li><span class="icon" style="color: var(--accent-green);"><i class="fa-solid fa-cloud-arrow-down"></i></span><div><strong>Veri Sızıntısı Boyutu</strong> <small>Sızdırılan hassas veri miktarı. (Başlangıç: 0 GB)</small></div></li>
                        <li><span class="icon" style="color: var(--accent-red);"><i class="fa-solid fa-hand-holding-dollar"></i></span><div><strong>Finansal Zarar</strong> <small>Krizin şirkete maliyeti. (Başlangıç: ₺0)</small></div></li>
                        <li><span class="icon" style="color: var(--accent-yellow);"><i class="fa-solid fa-users"></i></span><div><strong>Müşteri Güveni</strong> <small>Müşterilerin şirkete olan inancı. (Başlangıç: 100)</small></div></li>
                        <li><span class="icon" style="color: var(--accent-blue);"><i class="fa-solid fa-building-shield"></i></span><div><strong>İtibar Puanı</strong> <small>Şirketinizin kamuoyu ve sektördeki imajı. (Başlangıç: 100)</small></div></li>
                        <li><span class="icon" style="color: var(--accent-pink);"><i class="fa-solid fa-scale-balanced"></i></span><div><strong>Yasal Risk</strong> <small>Yasal uyum ihlali riski (Ölçek: Düşük-Yüksek). (Başlangıç: Düşük)</small></div></li>
                    </ul>
                </div>
            </div>

            <button class="btn btn-start" id="startButton"><i class="fa-solid fa-play"></i> Simülasyonu Başlat</button>
        </div>

        <div id="intermissionSection" class="centered-page" style="display: none;">
            <h2 id="intermissionTitle"></h2>
            <p id="intermissionText" style="max-width: 600px;"></p>
            <div class="interactive-element" style="width: 100%; max-width: 500px;">
                <h4>Karar Etkileri</h4>
                <div id="intermissionMetrics"></div>
            </div>
            <div class="interactive-element" style="width: 100%; max-width: 500px; border-left-color: var(--accent-blue); margin-top: 20px;">
                <h4>Stratejik Değerlendirme</h4>
                <p id="strategicText" style="font-size: 1em;"></p>
            </div>
            <button class="btn btn-continue" id="continueButton" style="margin-top: 30px;"><i class="fa-solid fa-forward"></i> Devam Et</button>
        </div>

        <div id="gameContainer" style="display: none;">
            <div id="statusBar">
                <div class="metric"><span><i class="fa-solid fa-cloud-arrow-down"></i> Sızan Veri</span><div class="value" id="status-dataLeakSize">0 GB</div></div>
                <div class="metric"><span><i class="fa-solid fa-hand-holding-dollar"></i> Finansal Zarar</span><div class="value" id="status-financialLoss">₺0</div></div>
                <div class="metric"><span><i class="fa-solid fa-users"></i> Müşteri Güveni</span><div class="value" id="status-customerTrust">100</div></div>
                <div class="metric"><span><i class="fa-solid fa-building-shield"></i> İtibar Puanı</span><div class="value" id="status-reputation">100</div></div>
                <div class="metric"><span><i class="fa-solid fa-scale-balanced"></i> Yasal Risk</span><div class="value" id="status-regulatoryRisk">Düşük</div></div>
                <div class="metric" id="status-timer"><span><i class="fa-solid fa-stopwatch"></i> Kalan Süre</span><div class="value" id="status-remaining">04:00</div></div>
            </div>
            <div id="game-content">
                
                <div id="day1_alarm" class="section">
                    <h2><i class="fa-solid fa-triangle-exclamation"></i> Gün 1: Veri Sızıntısı Alarmı - Lansmana 72 Saat Kala!</h2>
                    <h3>Sabah 09:00 - Güvenlik Ekibinden Gelen Çağrı ve Olağandışı Trafik</h3>
                    <p>Sabah, güvenlik operasyon ekibinden acil bir çağrıyla güne başlıyorsun. Baş Analist, bulut ortamınızdaki risk analiz ürününden dışarıya doğru olağandışı veri çekme talepleri olduğunu raporluyor. Özellikle `Analiz-Verileri-Uretim` adındaki veri deposundan normal olmayan bir trafik akışı var. Lansmana sadece 72 saat kaldı ve her dakika kritik.</p>
                    <p>Saldırganın potansiyel olarak:</p>
                    <ul>
                        <li>Herkese açık bırakılmış bir veri deposunu,</li>
                        <li>Hatalı yapılandırılmış bir erişim iznini,</li>
                        <li>Devre dışı kalmış bir ek güvenlik doğrulamasını,</li>
                        <li>Veya korumasız bir bulut fonksiyonunu kullandığı düşünülüyor.</li>
                    </ul>
                    <img src="images/alarm.png" alt="Veri sızıntısı alarmı görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>Kıdemli Bulut Güvenliği Uzmanı olarak ilk tepkin ne olacak?</h4>
                        <div class="decision-buttons">
                            <button class="btn" data-decision="d1-a-cut-connection" data-next-section="day1_s3_scan"><i class="fa-solid fa-cut"></i><div class="btn-text">Seçenek A: `Analiz-Verileri-Uretim` deposu ile tüm dış bağlantıları derhal kes.<small>Sızıntıyı anında durdurmak için hızlı ve radikal bir müdahale yap.</small></div></button>
                            <button class="btn" data-decision="d1-a-monitor-attacker" data-next-section="day1_s3_scan"><i class="fa-solid fa-eye"></i><div class="btn-text">Seçenek B: Sistemleri izlemeye devam ederek saldırganın yöntemlerini analiz et.<small>Saldırının doğasını, hedeflerini ve kullanılan zafiyetleri anlamak için gizli gözlem yap.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> Krizin ilk anları kritik öneme sahiptir. Hızlı müdahale mi, yoksa istihbarat toplama mı? Kararın hem teknik hem de operasyonel sonuçları olacak.</div>
                </div>

                <div id="day1_s3_scan" class="section">
                    <h2><i class="fa-solid fa-cloud-arrow-down"></i> Gün 1: Öğleden Sonra - Depolama Zafiyeti Keşfi</h2>
                    <h3>Öğleden Sonra 15:30 - "Analiz-Verileri-Uretim" Veri Deposu Herkese Açık!</h3>
                    <p>İlk müdahalelerin ardından, ekip `Analiz-Verileri-Uretim` veri deposunun yapılandırmasını derinlemesine incelemeye aldı. Şok edici bir bulguyla karşılaştınız: Veri deposu, yanlışlıkla "Herkese Açık" olarak ayarlanmış! Bu, saldırganın doğrudan isteklerle verileri çekebileceği anlamına geliyor. Ayrıca, denetim kayıtlarında, bu depodan son 24 saat içinde **500 GB'tan fazla veri** sızdırıldığına dair kesin kanıtlar bulundu. Bu, finans sektörüne yönelik risk analiz ürününüzün temelini oluşturan hassas analiz algoritmalarını ve müşteri test verilerini içeriyor.</p>
                    <img src="images/bucket.png" alt="Herkese açık S3 bucket görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>Bu kritik bulgu karşısında bir sonraki acil teknik adımın ne olacak?</h4>
                        <div class="decision-buttons">
                            <button class="btn critical" data-decision="d1-s3-close-access" data-next-section="day2_iam_review"><i class="fa-solid fa-lock"></i><div class="btn-text">Seçenek A: `Analiz-Verileri-Uretim` deposunun herkese açık erişimini derhal kapat ve izinleri en kısıtlı seviyeye getir.<small>En büyük güvenlik açığını anında kapat ve sızıntıyı durdur.</small></div></button>
                            <button class="btn" data-decision="d1-s3-scan-all" data-next-section="day2_iam_review"><i class="fa-solid fa-search-plus"></i><div class="btn-text">Seçenek B: Bulut ortamındaki tüm diğer veri depolarını da acil olarak güvenlik taramasından geçir.<small>Benzer yanlış yapılandırmaların olup olmadığını tespit etmek için kapsamlı bir denetim yap.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> Yanlış yapılandırmalar, bulut güvenliğinin en büyük zafiyetlerindendir. En kritik varlıkların erişim kontrolleri, sürekli denetlenmelidir.</div>
                </div>

                <div id="day2_iam_review" class="section">
                    <h2><i class="fa-solid fa-id-card-clip"></i> Gün 2: Sabah - Kimlik ve Erişim Felaketi</h2>
                    <h3>Sabah 09:30 - Eski Geliştiricinin Hayalet Hesabı ve Tam Yetki!</h3>
                    <p>Veri deposunun kapatılmasıyla birlikte, saldırının başka bir katmanını keşfetmek için erişim kayıtlarını incelemeye başladınız. Şirketten aylar önce ayrılan eski bir geliştiricinin (`developer_cem`) hesabının hala aktif olduğunu ve şok edici bir şekilde **tüm bulut kaynaklarına tam yetkiye** sahip olduğunu gördünüz! Bu hesabın, `Analiz-Verileri-Uretim` veri deposuna erişimden hemen önce, yönetim paneli üzerinden şüpheli işlemler yaptığı tespit edildi. Görünüşe göre saldırgan, bu "hayalet hesabı" kullanarak ilk erişimi sağlamış.</p>
                    <img src="images/root.png" alt="IAM Root Access görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>Bu kritik güvenlik açığını kapatmak ve saldırganın daha fazla hareketini engellemek için ne yapacaksın?</h4>
                        <div class="decision-buttons">
                            <button class="btn critical" data-decision="d2-iam-suspend-report" data-next-section="day2_internal_connections"><i class="fa-solid fa-user-slash"></i><div class="btn-text">Seçenek A: `developer_cem` hesabını derhal askıya al ve bulguları yöneticilerine acilen bildir.<small>Kritik bir güvenlik açığını kapat, ancak olayı üst yönetime raporlayarak sorumluluk al.</small></div></button>
                            <button class="btn" data-decision="d2-iam-delete-quietly" data-next-section="day2_internal_connections"><i class="fa-solid fa-user-minus"></i><div class="btn-text">Seçenek B: `developer_cem` hesabını kimseye bildirmeden derhal sil.<small>Açığı hızla kapat, ancak olayla ilgili resmi bir kayıt bırakmadan ve potansiyel iç soruşturmayı engellemeden.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> Erişim izinleri ve eski hesap yönetimi, bulut güvenliğinin temelini oluşturur. En küçük bir zafiyet dahi, tüm sisteme tam erişime yol açabilir.</div>
                </div>

                <div id="day2_internal_connections" class="section">
                    <h2><i class="fa-solid fa-arrows-turn-right"></i> Gün 2: Öğleden Sonra - İçeriden Şüpheli Bağlantılar</h2>
                    <h3>Öğleden Sonra 14:00 - Bir Saldırı Merkezi Fısıltısı mı?</h3>
                    <p>Eski geliştirici hesabının kullanılması, saldırganın sadece dışarıdan veri sızdırmadığını, aynı zamanda iç ağınızda da kalıcı olmaya çalıştığını düşündürüyor. Ağ trafiği kayıtlarında, içerideki bir bilgisayardan (`10.0.0.42`), şifreli ve sürekli olarak dışarıdaki bir Telegram sunucusuna veri aktarımı olduğunu tespit ettiniz. Bu bilgisayar, Finans Departmanı'ndaki bir geliştiriciye aitmiş.</p>
                    <p>Bu durum, saldırganın ele geçirdiği bir şirket içi cihazı, bir **saldırı kontrol merkezi** olarak kullandığına işaret ediyor olabilir. Ancak, bu aynı zamanda Finans Departmanı'ndaki geliştiricinin "izinli" bir test veya araştırma yapıyor olma ihtimalini de barındırıyor. CTO Furkan Tekin, departmanlarının sık sık dış hizmetlerle testler yaptığını belirtiyor.</p>
                    <img src="images/data.png" alt="Telegram veri aktarımı görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>Bu şüpheli iç bağlantıyı nasıl ele alacaksın?</h4>
                        <div class="decision-buttons">
                            <button class="btn" data-decision="d2-internal-isolate-device" data-next-section="day3_media_leak"><i class="fa-solid fa-plug-circle-xmark"></i><div class="btn-text">Seçenek A: Şüpheli cihazı derhal ağdan izole et ve adli inceleme başlat.<small>Potansiyel iç tehdidi anında durdur, ancak operasyonel aksaklığa ve çalışan moraline etki edebilir.</small></div></button>
                            <button class="btn critical" data-decision="d2-internal-confront-dev" data-next-section="day3_media_leak"><i class="fa-solid fa-user-secret"></i><div class="btn-text">Seçenek B: Finans departmanındaki geliştiriciyle doğrudan ve gizli bir görüşme ayarla.<small>Şüpheli bağlantının nedenini anlamak için doğrudan bilgi topla, ancak geliştiriciyi uyarabilir veya işbirliğini kaybetme riski taşırsın.</small></div></button>
                            <button class="btn" data-decision="d2-internal-monitor-further" data-next-section="day3_media_leak"><i class="fa-solid fa-chart-line"></i><div class="btn-text">Seçenek C: Cihazı izlemeye devam et ve daha fazla bilgi topla.<small>Saldırganın (veya geliştiricinin) niyetini anlamak için gözlemi sürdür, ancak veri sızıntısının devam etme riski var.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> İç tehditler, tespiti ve yönetimi en zor olanlardır. Yanlış kararlar, hem güvenlik hem de şirket içi güven üzerinde yıkıcı etkilere sahip olabilir.</div>
                </div>

                <div id="day3_media_leak" class="section">
                    <h2><i class="fa-solid fa-newspaper"></i> Gün 3: Sabah - Medya Sızıntısı ve İtibar Felaketi</h2>
                    <h3>Sabah 08:00 - Sosyal Medyada Gündem: "ÇOLHAK Ürününde Güvenlik Açığı!"</h3>
                    <p>Tam iç soruşturman devam ederken, kabus senaryosu gerçekleşir: Sosyal medyada yüksek takipçili bir teknoloji gazetecisi, "ÇOLHAK Teknoloji'nin çok beklenen ürün projesinde büyük bir güvenlik açığı ve müşteri veri sızıntısı iddiaları!" başlığıyla bir paylaşım yapıyor. Paylaşım hızla viral oluyor ve medya kuruluşları size ulaşmaya başlıyor. Lansmana sadece saatler kala, CEO Dilara Akın sizi acilen ofisine çağırıyor. Yüzünde ciddi bir ifade var: *"Bu bir felaket! Hemen bir açıklama yapmalıyız. İtibarımız yerle bir oluyor! Ne yapmalıyız?"*</p>
                    <img src="images/media.png" alt="Medya sızıntısı görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>PR Direktörü Serap Nur ve Hukuk Müşaviri ile birlikte, bu medya krizini nasıl yönetecek ve kamuoyuna nasıl bir mesaj vereceksin?</h4>
                        <div class="decision-buttons">
                            <button class="btn" data-decision="d3-media-full-disclosure" data-next-section="day3_management_decision"><i class="fa-solid fa-check-double"></i><div class="btn-text">Seçenek A: Tam Şeffaflıkla Hemen Basına Açıkla.<small>Olayı tüm detaylarıyla, sızıntının nedenini ve alınan önlemleri şeffafça kamuoyuna duyur.</small></div></button>
                            <button class="btn critical" data-decision="d3-media-deny-ignore" data-next-section="day3_management_decision"><i class="fa-solid fa-ban"></i><div class="btn-text">Seçenek B: İddiaları Kesinlikle Reddet ve Medyayla Teması Engelle.<small>Sızıntı iddialarını yalanla ve krizin büyümesini önlemek için medyadan uzak dur.</small></div></button>
                            <button class="btn" data-decision="d3-media-controlled-leak" data-next-section="day3_management_decision"><i class="fa-solid fa-user-secret"></i><div class="btn-text">Seçenek C: Sızıntının Kontrollü Bir Versiyonunu Yayınla.<small>Hassas detayları atlayarak, olayı önemsiz gösteren, kontrollü bir açıklama sızdır.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> Medya krizi, siber saldırının en yıkıcı sonuçlarından biri olabilir. İtibar yönetimi, şeffaflık, hız ve doğru mesaj, kamuoyu güvenini yeniden kazanmak için anahtardır.</div>
                </div>

                <div id="day3_management_decision" class="section">
                    <h2><i class="fa-solid fa-users-viewfinder"></i> Gün 3: Öğleden Sonra - Yönetim Kurulu Toplantısı ve Kritik Karar</h2>
                    <h3>Öğleden Sonra 13:00 - Lansman İptali mi?</h3>
                    <p>Medya krizinin ortasında, yönetim kurulu acil bir toplantı için bir araya gelir. Herkesin farklı bir önceliği vardır ve tansiyon yüksektir. Karar anı gelmiştir ve herkes sana bakıyor. Ve toplantının sonunda sana 2 seçenek sundular:</p>
                    <img src="images/board.png" alt="Yönetim kurulu toplantısı görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>Kıdemli Bulut Güvenliği Uzmanı olarak, tüm bu baskılar altında, şirketin kaderini belirleyecek son büyük teknik ve stratejik kararı nasıl vereceksin?</h4>
                        <div class="decision-buttons">
                            <button class="btn critical" data-decision="d3-m-take-offline" data-next-section="day3_regulatory_threat"><i class="fa-solid fa-power-off"></i><div class="btn-text">Seçenek A: Tüm kritik sistemleri derhal kapat ve kapsamlı bir güvenlik denetimi ve temizliği yap.<small>En güvenli yolu seç, ancak lansmanı süresiz ertele ve büyük finansal kayıplara yol aç.</small></div></button>
                            <button class="btn" data-decision="d3-m-patch-continue" data-next-section="day3_regulatory_threat"><i class="fa-solid fa-wrench"></i><div class="btn-text">Seçenek B: Hızlı güvenlik yamaları uygula ve ürün lansmanına devam et.<small>Riski kabul et, lansmanı kurtar, ancak gizli zafiyetler veya kalan saldırganlar için risk altında ol.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> Kritik iş kararları, teknik güvenlik riskleriyle doğrudan çelişebilir. Bu tür anlarda dengeyi bulmak ve yönetimle etkin iletişim kurmak hayati önem taşır.</div>
                </div>

                <div id="day3_regulatory_threat" class="section">
                    <h2><i class="fa-solid fa-gavel"></i> Gün 3: Akşam - Yasal Yükümlülükler</h2>
                    <h3>Akşam 18:00 - Hukuk Müşavirinden Çağrı</h3>
                    <p>Krizin teknik ve yönetimsel boyutlarıyla uğraşırken, Hukuk Müşaviri Zeynep Kaya'dan endişeli bir çağrı alıyorsun: *"Elimizdeki verilere göre, sızdırılan müşteri bilgileri KVKK ve GDPR kapsamında hassas veri niteliğinde. Bu, bize devasa para cezaları ve yasal davalar getirebilir. İlgili kurumlara 48 saat içinde resmi veri ihlali bildirimi yapmamız gerekiyor. Bu durum, kamuoyundaki algımızı ve yasal pozisyonumuzu doğrudan etkileyecek. Ne yapıyoruz?"*</p>
                    <img src="images/threat.png" alt="Regülasyon tehdidi görseli" class="scenario-image">
                    <div class="interactive-element">
                        <h4>Bu yasal yükümlülük ve itibar riskini nasıl ele alacaksın?</h4>
                            <div class="decision-buttons">
                            <button class="btn" data-decision="d3-e-officially-report" data-next-section="finalSection"><i class="fa-solid fa-file-invoice"></i><div class="btn-text">Seçenek A: Yasal Yükümlülükleri Yerine Getirerek Veri İhlalini Resmi Olarak Bildir.<small>Şeffaflığı ve yasal uyumu önceliklendir, ancak bu, şirketin itibarını daha fazla etkileyebilir.</small></div></button>
                            <button class="btn critical" data-decision="d3-e-internal-incident" data-next-section="finalSection"><i class="fa-solid fa-user-secret"></i><div class="btn-text">Seçenek B: Olayı İç Kaynaklı Küçük Bir Olay Olarak Göster ve Resmi Bildirimi Ertele.<small>Kısa vadede paniği önle, ancak uzun vadede yasal ve itibari riskleri artırabilir.</small></div></button>
                        </div>
                    </div>
                    <div class="learning-note"><strong>Öğrenme Notu:</strong> Veri ihlallerinde yasal uyumluluk, sadece cezalardan kaçınmakla kalmaz, aynı zamanda şirketin etik duruşunu ve müşteri güvenini de yansıtır.</div>
                </div>

                <div id="finalSection" class="section centered-page" style="display: none;">
                    <h2><i class="fa-solid fa-chart-line"></i> Kriz Sonrası Değerlendirme Raporu</h2>
                    <p>Simülasyon tamamlandı. Kriz yönetimi performansınızın detaylı dökümü aşağıdadır.</p>
                    <div id="performance-badge-container"><span id="performance-badge"></span></div>
                    <div class="final-metrics" id="finalMetricsContainer"></div>
                    <div class="post-crisis-layout">
                        <div class="event-timeline">
                            <h3><i class="fa-solid fa-timeline"></i> Karar Zaman Tüneli</h3>
                            <ul id="decision-timeline-list"></ul>
                        </div>
                        <div class="strategic-debrief">
                            <h3><i class="fa-solid fa-lightbulb"></i> Stratejik Değerlendirme</h3>
                            <div id="strategic-debrief-content">
                                </div>
                            <h3 style="margin-top: 20px;"><i class="fa-solid fa-calculator"></i> Puan Dökümü</h3>
                            <ul id="score-breakdown">
                                </ul>
                        </div>
                    </div>
                    <div class="decision-buttons" style="margin-top: 40px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
                        <button class="btn btn-start" onclick="location.reload()"><i class="fa-solid fa-arrow-rotate-right"></i> Simülasyonu Yeniden Başlat</button>
                        <button class="btn" id="openLeaderboardBtn"><i class="fa-solid fa-trophy"></i> Liderlik Tablosu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="lb-overlay" id="leaderboardOverlay" role="dialog" aria-modal="true" aria-labelledby="lbTitle">
        <div class="lb-modal">
            <h2 id="lbTitle" class="lb-title"><i class="fa-solid fa-trophy"></i> Liderlik Tablosu</h2>
            <div class="lb-tablewrap">
                <table class="lb-table" id="leaderboardTable">
                    <thead>
                        <tr><th>#</th><th>İsim</th><th>Puan</th><th>Tarih</th></tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr><td colspan="4">Yükleniyor…</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="lb-actions">
                <button class="lb-refresh" id="lbRefreshBtn"><i class="fa-solid fa-arrows-rotate"></i> Yenile</button>
                <button class="lb-close" id="lbCloseBtn">Kapat</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            window.game = {
                score: { dataLeakSize: 0, financialLoss: 0, customerTrust: 100, reputation: 100, regulatoryRisk: 'Düşük' },
                state: {
                    currentSectionId: 'start',
                    decisionHistory: [],
                    totalScore: null,
                    madeOfficialReport: false // Yasal bildirim kararını takip etmek için eklendi
                },
                elements: {},
                timer: {
                    total: 240,
                    remaining: 240,
                    intervalId: null,
                    running: false
                },
                
                decisionInfo: {
                    'd1-a-cut-connection': { title: "Dış Bağlantıları Kes", text: "`Analiz-Verileri-Uretim` deposu ile tüm dış bağlantılar derhal kesildi. Sızıntı anında durduruldu, ancak ne kadar verinin sızdığı veya saldırganın kimliği hakkında daha az bilgiye sahipsin.", strat: "Veri sızıntılarında hızlı izolasyon, hasarı minimize etmek için kritik bir adımdır. Ancak, bu, saldırganın yöntemleri hakkında istihbarat toplama fırsatını kaçırmana neden olabilir.", changes: { dataLeakSize: 50, financialLoss: 25000, customerTrust: -5, reputation: -3 }, impact: 'Positive' },
                    'd1-a-monitor-attacker': { title: "Saldırganı İzle", text: "Sistemleri izlemeye devam ederek saldırganın yöntemlerini analiz ettin. Bu sayede saldırganın kullandığı zafiyeti (açık veri deposu) ve sızdırdığı veri türlerini net bir şekilde tespit ettin. Ancak bu sırada daha fazla veri sızdı.", strat: "Saldırganı izlemek, gelecekteki savunmalar için değerli istihbarat sağlar. Ancak bu taktik, daha fazla veri sızıntısı riskini içerir ve büyük bir kumar olabilir.", changes: { dataLeakSize: 150, financialLoss: 50000, customerTrust: -15, reputation: -10 }, impact: 'Negative' },
                    'd1-s3-close-access': { title: "Herkese Açık Erişimi Kapat", text: "`Analiz-Verileri-Uretim` veri deposunun herkese açık erişimini derhal kapattın ve izinlerini en kısıtlı seviyeye getirdin. Bu, en büyük güvenlik açığını anında kapattı ve sızıntıyı durdurdu.", strat: "Yanlış yapılandırmaların hızlı bir şekilde giderilmesi, bulut güvenliğinde en etkili savunma yöntemlerinden biridir. Bu, veri sızıntısını hızla durdurur.", changes: { dataLeakSize: 20, financialLoss: 10000, customerTrust: +5, reputation: +5 }, impact: 'Positive' },
                    'd1-s3-scan-all': { title: "Tüm Veri Depolarını Tara", text: "Bulut ortamındaki tüm diğer veri depolarını da acil olarak güvenlik taramasından geçirdin. Bu, başka 2 potansiyel yanlış yapılandırma tespit etmene olanak sağladı, ancak `Analiz-Verileri-Uretim` deposundaki sızıntı bir süre daha devam etti.", strat: "Kapsamlı denetim, benzer zafiyetlerin tespit edilmesi için önemlidir. Ancak, mevcut krizi durdurmada önceliği geciktirebilir.", changes: { dataLeakSize: 100, financialLoss: 30000, customerTrust: -10, reputation: -7 }, impact: 'Neutral' },
                    'd2-iam-suspend-report': { title: "Erişim Hesabını Askıya Al ve Raporla", text: "`developer_cem` hesabını derhal askıya aldın ve bulguları yöneticilerine acilen bildirdin. Bu, güvenlik açığını kapattı ve yönetimi olaya dahil etti, ancak iç gerilimi artırdı.", strat: "Erişim zafiyetlerinde hızlı müdahale ve şeffaf raporlama, hem teknik çözümü sağlar hem de kurumsal risk yönetimini destekler.", changes: { financialLoss: 5000, customerTrust: -2, reputation: -1 }, impact: 'Positive' },
                    'd2-iam-delete-quietly': { title: "Erişim Hesabını Sessizce Sil", text: "`developer_cem` hesabını kimseye bildirmeden derhal sildin. Açığı hızla kapattın ve olayı örtbas etmeye çalıştın. Bu, kısa vadede paniği önledi ancak uzun vadede yasal riskleri ve güven eksikliğini artırdı.", strat: "Gizlilik ve hızlı çözüm bazen cazip gelse de, siber krizlerde şeffaflık ve doğru kayıt tutma yasal ve etik açıdan hayati öneme sahiptir.", changes: { financialLoss: 20000, customerTrust: -10, reputation: -8, regulatoryRisk: 'Orta' }, impact: 'Negative' },
                    'd2-internal-isolate-device': { title: "Şüpheli Cihazı İzole Et", text: "Finans Departmanı'ndaki şüpheli cihazı derhal ağdan izole ettin ve adli inceleme başlattın. Bu, potansiyel iç tehdidi anında durdurdu ve daha fazla veri sızıntısını engelledi. Ancak geliştiricinin işi aksadı ve moralini düşürdü.", strat: "İç tehdit şüphesinde hızlı izolasyon, yayılımı durdurmak için önemlidir. Ancak, operasyonel etkiyi ve insan faktörünü göz önünde bulundurmalısın.", changes: { dataLeakSize: 0, financialLoss: 10000, customerTrust: -2, reputation: -1 }, impact: 'Positive' },
                    'd2-internal-confront-dev': { title: "Geliştiriciyle Yüzleş", text: "Finans departmanındaki geliştiriciyle doğrudan ve gizli bir görüşme ayarladın. Geliştirici, kişisel bir projede kullandığı bir test aracıyla Telegram'a veri gönderdiğini itiraf etti. Bu sana önemli bir içgörü sağladı ancak şirket içi güveni zedeledi.", strat: "Doğrudan görüşme, insan istihbaratı için değerlidir ancak potansiyel olarak tehdidi uyarabilir veya çatışmaya yol açabilir. Etik sınırlar önemlidir.", changes: { dataLeakSize: 50, financialLoss: 5000, customerTrust: -5, reputation: -3 }, impact: 'Neutral' },
                    'd2-internal-monitor-further': { title: "Cihazı İzlemeye Devam Et", text: "Cihazı izlemeye devam ettin ve daha fazla bilgi topladın. Bu süreçte cihazdan kritik düzeyde veri sızıntısı devam etti, ancak sana gelecekteki saldırılara karşı değerli savunma stratejileri geliştirmende yardımcı olacak detaylı istihbarat topladın.", strat: "Gözlem ve istihbarat toplama, uzun vadede daha iyi savunma stratejileri geliştirmek için önemlidir. Ancak bu süreç, aktif bir tehdit durumunda ciddi veri kaybı riskini artırır.", changes: { dataLeakSize: 200, financialLoss: 30000, customerTrust: -20, reputation: -15 }, impact: 'Negative' },
                    'd3-media-full-disclosure': { title: "Tam Şeffaflıkla Hemen Açıkla", text: "Olayı tüm detaylarıyla, sızıntının nedenini (yanlış yapılandırma), alınan önlemleri ve müşteri verilerinin etkilenme durumunu şeffafça kamuoyuna duyurdun. Bu, başlangıçta büyük bir medya fırtınası yaratsa da, uzun vadede şirketine olan güveni artırdı.", strat: "Kriz iletişiminde tam şeffaflık, kısa vadeli şoku artırabilir ancak uzun vadede güven ve itibarı güçlendirir. Dürüstlük, en iyi politikadır.", changes: { financialLoss: 100000, customerTrust: +10, reputation: +15, regulatoryRisk: 'Düşük' }, impact: 'Positive' },
                    'd3-media-deny-ignore': { title: "İddiaları Reddet ve Medyayla Teması Engelle", text: "Sızıntı iddialarını yalanladın ve krizin büyümesini önlemek için medyadan uzak durdun. Bu, kısa vadede haber akışını yavaşlatsa da, gerçekler ortaya çıktığında şirketin itibarını geri dönülmez şekilde zedeledi ve yasal soruşturmaları tetikledi.", strat: "Gerçekleri inkar etmek, kısa vadede durumu 'idare' etse de, modern dünyada bilginin yayılma hızı göz önüne alındığında uzun vadeli ve daha büyük felaketlere yol açar.", changes: { financialLoss: 500000, customerTrust: -40, reputation: -30, regulatoryRisk: 'Yüksek' }, impact: 'Negative' },
                    'd3-media-controlled-leak': { title: "Sızıntının Kontrollü Bir Versiyonunu Yayınla", text: "Hassas detayları atlayarak, olayı önemsiz gösteren, kontrollü bir açıklama sızdırdın. Bu, halkla ilişkiler ekibinin baskısını azaltsa da, gerçekler zamanla ortaya çıktığında müşteri güvenini sarstı ve şirketin şeffaflık algısını zedeledi.", strat: "Kısmi şeffaflık, geçici olarak durumu yatıştırabilir. Ancak, bilgi boşlukları spekülasyonlara ve daha büyük şüpheye yol açarak uzun vadeli itibar kaybına neden olabilir.", changes: { financialLoss: 250000, customerTrust: -20, reputation: -15, regulatoryRisk: 'Orta' }, impact: 'Neutral' },
                    'd3-m-take-offline': { title: "Tüm Kritik Sistemleri Kapat", text: "Tüm kritik sistemleri derhal kapattın ve kapsamlı bir güvenlik denetimi ile temizlik başlattın. Bu, ürün lansmanını süresiz erteledi ve büyük finansal kayıplara yol açtı, ancak sızıntının tamamen durmasını ve gelecekteki güvenliği sağladı.", strat: "Kritik bir ihlalde radikal önlemler, tam güvenliği garanti edebilir. Ancak bu, ciddi operasyonel ve finansal maliyetleri beraberinde getirir. İş sürekliliği ile güvenlik arasında zor bir denge.", changes: { dataLeakSize: +20, financialLoss: 1000000, customerTrust: -30, reputation: -20, regulatoryRisk: 'Düşük' }, impact: 'Negative' },
                    'd3-m-patch-continue': { title: "Hızlı Yamalar Uygula ve Lansmana Devam Et", text: "Hızlı güvenlik yamaları uyguladın ve ürün lansmanına devam etme kararı aldın. Bu, lansmanı kurtardı ve finansal kayıpları azalttı, ancak sistemde gizli zafiyetler veya kalan saldırganlar için risk altında olunduğu anlamına geliyor.", strat: "Risk iştahı ve iş öncelikleri doğrultusunda hızlı çözümler uygulamak mümkündür. Ancak bu, siber riskin tamamen ortadan kalkmadığı, sadece azaltıldığı anlamına gelir ve gelecekteki tehditler için bir kumar olabilir.", changes: { dataLeakSize: +50, financialLoss: 200000, customerTrust: +5, reputation: +5, regulatoryRisk: 'Orta' }, impact: 'Neutral' },
                    'd3-e-officially-report': { title: "Veri İhlalini Resmi Olarak Bildir", text: "Yasal yükümlülükleri yerine getirerek veri ihlalini ilgili kurumlara resmi olarak bildirdin. Bu, şirketin şeffaflığını ve yasalara uyumunu gösterdi, ancak medya ve kamuoyu baskısını artırdı ve potansiyel para cezalarının önünü açtı.", strat: "Yasal uyumluluk ve şeffaflık, uzun vadeli itibar ve güven için hayati öneme sahiptir. Kısa vadeli zorluklara rağmen doğru olanı yapmak, şirketin etik duruşunu güçlendirir.", changes: { financialLoss: 50000, customerTrust: +10, reputation: +5, regulatoryRisk: 'Düşük' }, impact: 'Positive', clue: 'madeOfficialReport' },
                    'd3-e-internal-incident': { title: "Olayı Önemsiz Göstererek Bildirimi Ertele", text: "Olayı iç kaynaklı küçük bir güvenlik olayı olarak göstermeye ve resmi bildirimi ertelemeye karar verdin. Bu, kısa vadede paniği ve yasal süreçleri engelledi, ancak uzun vadede şirketin itibarını geri dönülmez şekilde zedeledi ve çok daha ağır yasal sonuçlara yol açma riski taşıyor.", strat: "Gerçekleri saptırmak veya gizlemek, kısa vadede fayda sağlayabilir, ancak modern denetim ve şeffaflık beklentileri karşısında uzun vadede felaketle sonuçlanır. Güveni kaybedersin.", changes: { financialLoss: 150000, customerTrust: -20, reputation: -15, regulatoryRisk: 'Çok Yüksek' }, impact: 'Negative' },
                },

                setup() {
                    this.elements = {
                        intro: document.getElementById('introSection'), 
                        game: document.getElementById('gameContainer'), 
                        gameContent: document.getElementById('game-content'),
                        startButton: document.getElementById('startButton'), 
                        intermission: document.getElementById('intermissionSection'),
                        intermissionTitle: document.getElementById('intermissionTitle'), 
                        intermissionText: document.getElementById('intermissionText'),
                        intermissionMetrics: document.getElementById('intermissionMetrics'), 
                        strategicText: document.getElementById('strategicText'),
                        continueButton: document.getElementById('continueButton'),
                        statusBar: { 
                            dataLeakSize: document.getElementById('status-dataLeakSize'), 
                            financialLoss: document.getElementById('status-financialLoss'), 
                            customerTrust: document.getElementById('status-customerTrust'), 
                            reputation: document.getElementById('status-reputation'), 
                            regulatoryRisk: document.getElementById('status-regulatoryRisk'),
                            remaining: document.getElementById('status-remaining')
                        },
                        leaderboard: {
                            overlay: document.getElementById('leaderboardOverlay'),
                            body: document.getElementById('leaderboardBody'),
                            table: document.getElementById('leaderboardTable'),
                            btnOpen: document.getElementById('openLeaderboardBtn'),
                            btnClose: document.getElementById('lbCloseBtn'),
                            btnRefresh: document.getElementById('lbRefreshBtn')
                        }
                    };
                    this.loadGameHTML();
                    this.attachListeners();
                    this.elements.intro.style.display = 'flex';
                    this.elements.game.style.display = 'none';
                },

                attachListeners() {
                    this.elements.startButton.addEventListener('click', () => {
                        this.elements.intro.style.display = 'none';
                        this.elements.game.style.display = 'block';
                        this.startGlobalTimer();
                        this.showSection('day1_alarm'); 
                    });
                    
                    this.elements.gameContent.addEventListener('click', (e) => {
                        const button = e.target.closest('.btn[data-decision]');
                        if (!button || button.disabled) return; 
                        
                        const decisionId = button.dataset.decision;
                        const nextSection = button.dataset.nextSection;

                        this.handleDecision(decisionId, nextSection);
                    });

                    this.elements.continueButton.addEventListener('click', () => {
                        const nextSectionId = this.elements.continueButton.dataset.nextSection;
                        this.elements.intermission.style.display = 'none';
                        
                        if (nextSectionId === 'finalSection') {
                            this.showFinalReport();
                        } else {
                            this.elements.game.style.display = 'block';
                            this.showSection(nextSectionId);
                        }
                    });

                    this.elements.leaderboard.btnOpen?.addEventListener('click', () => this.openLeaderboard());
                    this.elements.leaderboard.btnClose?.addEventListener('click', () => this.closeLeaderboard());
                    this.elements.leaderboard.btnRefresh?.addEventListener('click', () => this.loadLeaderboard());
                    this.elements.leaderboard.overlay.addEventListener('click', (e) => {
                        if (e.target === this.elements.leaderboard.overlay) this.closeLeaderboard();
                    });
                },
                
                handleDecision(decisionId, nextSectionId) {
                    const info = this.decisionInfo[decisionId];
                    if (!info) { console.error("Decision info not found:", decisionId); return; }

                    this.score.dataLeakSize += info.changes.dataLeakSize || 0;
                    this.score.financialLoss += info.changes.financialLoss || 0;
                    this.score.customerTrust = Math.max(0, Math.min(100, this.score.customerTrust + (info.changes.customerTrust || 0)));
                    this.score.reputation = Math.max(0, Math.min(100, this.score.reputation + (info.changes.reputation || 0)));
                    this.score.regulatoryRisk = info.changes.regulatoryRisk || this.score.regulatoryRisk;
                    
                    if (info.clue === 'madeOfficialReport') {
                        this.state.madeOfficialReport = true;
                    }
                    
                    this.state.decisionHistory.push({ id: decisionId, title: info.title, text: info.text, impactType: info.impact }); 
                    
                    this.updateState();
                    this.showIntermission(info.title, info.text, info.strat, info.changes, nextSectionId);
                },

                showIntermission(title, text, strat, changes, nextSectionId) {
                    this.elements.intermissionTitle.textContent = title;
                    this.elements.intermissionText.textContent = text;
                    this.elements.strategicText.textContent = strat;
                    
                    let metricsHTML = '';
                    const formatChange = (label, value, unit, icon) => {
                         let colorClass = 'neutral';
                         let displayValue = value;
                         let arrowIcon = ''; 
                         let sign = '';
                         
                         if (typeof value === 'number') {
                             if (value > 0) {
                                 colorClass = (label === 'Müşteri Güveni' || label === 'İtibar Puanı') ? 'positive' : 'negative';
                                 arrowIcon = 'fa-arrow-up-long';
                                 sign = '+';
                             } else if (value < 0) {
                                 colorClass = (label === 'Müşteri Güveni' || label === 'İtibar Puanı') ? 'negative' : 'positive';
                                 arrowIcon = 'fa-arrow-down-long';
                             }
                             displayValue = `${sign}${value.toLocaleString('tr-TR')}`;
                         } else {
                            if(label === 'Yasal Risk') {
                                if(value === 'Düşük') colorClass = 'positive';
                                if(value === 'Orta') colorClass = 'neutral';
                                if(value === 'Yüksek' || value === 'Çok Yüksek') colorClass = 'negative';
                            }
                         }

                         return `<div class="metric-change ${colorClass}"><i class="fa-solid ${icon}"></i> ${label}: ${arrowIcon ? `<i class="fa-solid ${arrowIcon}"></i>` : ''} ${displayValue}${unit}</div>`;
                    };

                    if (changes.dataLeakSize !== undefined && changes.dataLeakSize !== 0) metricsHTML += formatChange('Veri Sızıntısı Boyutu', changes.dataLeakSize, ' GB', 'fa-cloud-arrow-down');
                    if (changes.financialLoss !== undefined && changes.financialLoss !== 0) metricsHTML += formatChange('Finansal Zarar', changes.financialLoss, '₺', 'fa-hand-holding-dollar');
                    if (changes.customerTrust !== undefined && changes.customerTrust !== 0) metricsHTML += formatChange('Müşteri Güveni', changes.customerTrust, '', 'fa-users');
                    if (changes.reputation !== undefined && changes.reputation !== 0) metricsHTML += formatChange('İtibar Puanı', changes.reputation, '', 'fa-building-shield');
                    if (changes.regulatoryRisk !== undefined) metricsHTML += formatChange('Yasal Risk', changes.regulatoryRisk, '', 'fa-scale-balanced');
                    
                    if (metricsHTML === '') metricsHTML = '<p style="text-align: center; font-size: 1em; opacity: 0.8;">Bu kararın metrikler üzerinde doğrudan bir etkisi olmadı.</p>';

                    this.elements.intermissionMetrics.innerHTML = metricsHTML;
                    this.elements.continueButton.dataset.nextSection = nextSectionId;
                    this.elements.game.style.display = 'none';
                    this.elements.intermission.style.display = 'flex';
                },

                updateStatusBar() {
                    const s = this.score;
                    this.elements.statusBar.dataLeakSize.textContent = `${s.dataLeakSize} GB`;
                    this.elements.statusBar.financialLoss.textContent = `₺${s.financialLoss.toLocaleString('tr-TR')}`;
                    this.elements.statusBar.customerTrust.textContent = Math.max(0, s.customerTrust);
                    this.elements.statusBar.reputation.textContent = Math.max(0, s.reputation);
                    this.elements.statusBar.regulatoryRisk.textContent = s.regulatoryRisk;
                },

                showSection(sectionId) {
                    this.elements.sections.forEach(section => { section.style.display = 'none'; });
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        this.state.currentSectionId = sectionId;
                        this.updateDynamicContent(sectionId);
                    } else {
                        console.error('Bölüm bulunamadı:', sectionId);
                        this.showFinalReport();
                    }
                    this.updateState();
                },
                
                showFinalReport() {
                    this.stopGlobalTimer();

                    this.elements.intro.style.display = 'none';
                    this.elements.intermission.style.display = 'none';
                    this.elements.game.style.display = 'block'; 
                    document.getElementById('statusBar').style.display = 'none';

                    this.elements.sections.forEach(section => { section.style.display = 'none'; });
                    
                    const finalSection = document.getElementById('finalSection');
                    if (!finalSection) { console.error("Final bölümü HTML'de bulunamadı!"); return; }
                    finalSection.style.display = 'flex';
                    
                    const badge = document.getElementById('performance-badge');
                    const metricsContainer = document.getElementById('finalMetricsContainer');
                    const timelineList = document.getElementById('decision-timeline-list');
                    const debriefContent = document.getElementById('strategic-debrief-content');
                    const scoreBreakdownList = document.getElementById('score-breakdown');
                    
                    // --- YENİ PUANLAMA SİSTEMİ ---
                    let scoreBreakdown = {};
                    let totalScore = 50; // Baz Puan
                    scoreBreakdown['Başlangıç Puanı'] = { value: 50, class: 'score-neutral' };

                    // 1. Veri Sızıntısı Performansı
                    if (this.score.dataLeakSize <= 100) {
                        totalScore += 20;
                        scoreBreakdown['Veri Sızıntısı Kontrolü (<100GB)'] = { value: 20, class: 'score-plus' };
                    } else if (this.score.dataLeakSize <= 300) {
                        totalScore += 5;
                        scoreBreakdown['Veri Sızıntısı Kontrolü (<300GB)'] = { value: 5, class: 'score-plus' };
                    } else if (this.score.dataLeakSize <= 600) {
                        totalScore -= 10;
                        scoreBreakdown['Veri Sızıntısı Zafiyeti (>300GB)'] = { value: -10, class: 'score-minus' };
                    } else {
                        totalScore -= 20;
                        scoreBreakdown['Büyük Veri Sızıntısı (>600GB)'] = { value: -20, class: 'score-minus' };
                    }

                    // 2. Finansal Zarar Performansı
                    if (this.score.financialLoss <= 100000) {
                        totalScore += 20;
                        scoreBreakdown['Finansal Yönetim (<₺100k)'] = { value: 20, class: 'score-plus' };
                    } else if (this.score.financialLoss <= 400000) {
                        totalScore += 5;
                        scoreBreakdown['Finansal Yönetim (<₺400k)'] = { value: 5, class: 'score-plus' };
                    } else if (this.score.financialLoss <= 800000) {
                        totalScore -= 10;
                        scoreBreakdown['Finansal Kayıp (>₺400k)'] = { value: -10, class: 'score-minus' };
                    } else {
                        totalScore -= 20;
                        scoreBreakdown['Büyük Finansal Kayıp (>₺800k)'] = { value: -20, class: 'score-minus' };
                    }

                    // 3. Müşteri Güveni ve İtibar Performansı
                    const avgTrustReputation = (this.score.customerTrust + this.score.reputation) / 2;
                    if (avgTrustReputation >= 80) {
                        totalScore += 20;
                        scoreBreakdown['Güven & İtibar Yönetimi (>80)'] = { value: 20, class: 'score-plus' };
                    } else if (avgTrustReputation >= 50) {
                        totalScore += 10;
                        scoreBreakdown['Güven & İtibar Yönetimi (>50)'] = { value: 10, class: 'score-plus' };
                    } else if (avgTrustReputation >= 20) {
                        totalScore -= 10;
                        scoreBreakdown['Güven & İtibar Kaybı (<50)'] = { value: -10, class: 'score-minus' };
                    } else {
                        totalScore -= 20;
                        scoreBreakdown['Büyük Güven & İtibar Kaybı (<20)'] = { value: -20, class: 'score-minus' };
                    }

                    // 4. Kritik Karar: Yasal Bildirim
                    if (this.state.madeOfficialReport) {
                        totalScore += 15;
                        scoreBreakdown['Kritik Karar: Yasal Sorumluluk'] = { value: 15, class: 'score-plus' };
                    } else {
                        if(this.score.regulatoryRisk !== 'Düşük') {
                            totalScore -= 20;
                            scoreBreakdown['Kritik Hata: Yasal Sorumluluktan Kaçınma'] = { value: -20, class: 'score-minus' };
                        }
                    }

                    totalScore = Math.round(Math.max(0, Math.min(100, totalScore))); 
                    this.state.totalScore = totalScore;

                    let badgeInfo = {};
                    if (totalScore >= 85) { 
                        badgeInfo = { text: 'BULUT KAHRAMANI', color: 'var(--accent-green)' };
                    } else if (totalScore >= 60) { 
                        badgeInfo = { text: 'DİRENÇLİ BULUT UZMANI', color: 'var(--accent-blue)' };
                    } else if (totalScore >= 35) { 
                        badgeInfo = { text: 'BULUTTA ZORLU DENEYİM', color: 'var(--accent-yellow)' };
                    } else { 
                        badgeInfo = { text: 'BULUT FELAKETİ', color: 'var(--accent-red)' };
                    }
                    // --- PUANLAMA SİSTEMİ SONU ---

                    badge.textContent = badgeInfo.text;
                    badge.style.backgroundColor = badgeInfo.color;

                    metricsContainer.innerHTML = `
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-file-invoice-dollar"></i></div><div class="label">Nihai Puan</div><div class="value">${totalScore}/100</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-cloud-arrow-down"></i></div><div class="label">Toplam Sızan Veri</div><div class="value">${this.score.dataLeakSize} GB</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-hand-holding-dollar"></i></div><div class="label">Toplam Finansal Zarar</div><div class="value">₺${this.score.financialLoss.toLocaleString('tr-TR')}</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-users"></i></div><div class="label">Son Müşteri Güveni</div><div class="value">${this.score.customerTrust}/100</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-building-shield"></i></div><div class="label">Son İtibar Puanı</div><div class="value">${this.score.reputation}/100</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-scale-balanced"></i></div><div class="label">Son Yasal Risk</div><div class="value">${this.score.regulatoryRisk}</div></div>
                    `;

                    timelineList.innerHTML = this.state.decisionHistory.map(decision => {
                        let liClass = decision.impactType.toLowerCase();
                        return `<li class="${liClass}"><span class="decision-title">${decision.title}</span></li>`;
                    }).join('');
                    
                    // Puan dökümünü ekrana yazdır
                    scoreBreakdownList.innerHTML = Object.entries(scoreBreakdown).map(([key, item]) => {
                         const sign = item.value > 0 ? '+' : '';
                         return `<li class="${item.class}"><span>${key}</span><span class="score-value">${sign}${item.value} Puan</span></li>`;
                    }).join('');

                    let debriefHTML = '';
                    if (badgeInfo.text === 'BULUT KAHRAMANI') { 
                        debriefHTML += `<p><strong>Olağanüstü Başarı!</strong> Bir Kıdemli Bulut Güvenliği Uzmanı olarak, bulut ortamınızdaki sinsi zafiyetleri ustalıkla tespit ettiniz ve en hassas müşteri verilerinin sızıntısını minimuma indirdiniz. Hızlı teknik müdahaleleriniz, doğru iletişim stratejileriniz ve yasal uyumdaki liderliğiniz sayesinde ÇOLHAK Teknoloji, bu büyük krizden güçlenerek çıktı. Bulut güvenliğinde sektör lideri olduğunuzu kanıtladınız!</p>`;
                    } else if (badgeInfo.text === 'DİRENÇLİ BULUT UZMANI') { 
                        debriefHTML += `<p><strong>Başarılı Bir Müdahale!</strong> Oldukça karmaşık bir bulut güvenliği kriziyle karşı karşıya kalmanıza rağmen, etkili teknik müdahalelerle ve stratejik kararlarla krizi kontrol altına almayı başardınız. Bazı veri sızıntıları ve finansal kayıplar yaşansa da, genel olarak müşteri güvenini ve şirket itibarını önemli ölçüde korudunuz. Aldığınız derslerle gelecekteki bulut güvenliği duruşunuzu daha da sağlamlaştıracaksınız.</p>`;
                    } else if (badgeInfo.text === 'BULUTTA ZORLU DENEYİM') { 
                        debriefHTML += `<p><strong>Öğrenilen Büyük Dersler:</strong> Bulut güvenliği krizini yönetmekte zorlandınız ve kritik müşteri verilerinin sızmasıyla sonuçlanan önemli kayıplar yaşadınız. Finansal zararlar arttı ve şirketin itibarı ciddi şekilde zedelendi. Ancak bu deneyim, bulut güvenliği stratejilerinizi kökten değiştirmek ve altyapınızı daha sağlam hale getirmek için paha biçilmez dersler sağladı. Acil eylem planlarına ihtiyacınız var.</p>`;
                    } else { 
                        debriefHTML += `<p><strong>BULUT FELAKETİ:</strong> Kıdemli Bulut Güvenliği Uzmanı olarak bu krizi yönetmekte ciddi zorluklar yaşadınız. Büyük miktarda hassas müşteri verisi sızdırıldı, finansal kayıplar devasa boyutlara ulaştı ve şirketin itibarı ile müşteri güveni tamamen çöktü. Yasal soruşturmalar ve yüksek para cezaları kaçınılmaz görünüyor. Bu durum, ÇOLHAK Teknoloji için bulut güvenliği stratejilerinde köklü bir değişim gerektiren acı bir ders oldu.</p>`;
                    }
                    document.getElementById('strategic-debrief-content').innerHTML = debriefHTML;
                    
                    this.saveLeaderboard(totalScore);
                },

                updateState() { this.updateStatusBar(); this.updateSlackChat(this.state.currentSectionId); },

                updateSlackChat(currentSection) {
                    const sectionElement = document.getElementById(currentSection);
                    if (!sectionElement) return;
                    const chatViewer = sectionElement.querySelector('.slack-chat');
                    if (!chatViewer) return; 
                    let chat = '';
                    // Slack chat logic... (Mevcut haliyle kalabilir)
                    chatViewer.innerHTML = chat;
                },
                
                updateDynamicContent(sectionId) {},

                loadGameHTML() {
                    this.elements.sections = document.querySelectorAll('#game-content .section');
                    if (typeof hljs !== 'undefined') {
                        hljs.highlightAll();
                    }
                },

                /* === GLOBAL TIMER & LEADERBOARD FONKSİYONLARI === */
                startGlobalTimer() {
                    if (this.timer.running) return;
                    this.timer.running = true;
                    this.timer.remaining = this.timer.total;
                    this.updateTimerUI();
                    this.timer.intervalId = setInterval(() => {
                        this.timer.remaining--;
                        this.updateTimerUI();
                        if (this.timer.remaining <= 0) {
                            this.stopGlobalTimer();
                            this.showFinalReport();
                        }
                    }, 1000);
                },

                stopGlobalTimer() {
                    if (this.timer.intervalId) clearInterval(this.timer.intervalId);
                    this.timer.intervalId = null;
                    this.timer.running = false;
                },

                updateTimerUI() {
                    const m = String(Math.floor(this.timer.remaining / 60)).padStart(2,'0');
                    const s = String(this.timer.remaining % 60).padStart(2,'0');
                    if (this.elements.statusBar.remaining) {
                        this.elements.statusBar.remaining.textContent = `${m}:${s}`;
                    }
                },

                openLeaderboard() {
                    this.elements.leaderboard.overlay.style.display = 'flex';
                    this.loadLeaderboard();
                },

                closeLeaderboard() {
                    this.elements.leaderboard.overlay.style.display = 'none';
                },

                async saveLeaderboard(finalScore) {
                    const name = (localStorage.getItem('playerName') || 'Anonim').toString().slice(0, 40);
                    const payload = {
                        scenario: 'v6-cloud',
                        name,
                        score: finalScore,
                        details: {
                            dataLeakSize: this.score.dataLeakSize,
                            financialLoss: this.score.financialLoss,
                            customerTrust: this.score.customerTrust,
                            reputation: this.score.reputation,
                            regulatoryRisk: this.score.regulatoryRisk,
                            decisions: this.state.decisionHistory.map(d => d.id)
                        },
                        timeSpentSec: this.timer.total - this.timer.remaining,
                        timestamp: new Date().toISOString()
                    };

                    try {
                        const res = await fetch('/api/score', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!res.ok) throw new Error('HTTP ' + res.status);
                    } catch(e) {
                        const key = 'leaderboard-v6-cloud';
                        const arr = JSON.parse(localStorage.getItem(key) || '[]');
                        arr.push(payload);
                        arr.sort((a,b)=> b.score - a.score);
                        localStorage.setItem(key, JSON.stringify(arr.slice(0,100)));
                    }
                },

                async loadLeaderboard() {
                    const tbody = this.elements.leaderboard.body;
                    const key = 'leaderboard-v6-cloud';
                    tbody.innerHTML = `<tr><td colspan="4">Yükleniyor…</td></tr>`;
                    let rows = [];
                    try {
                        const res = await fetch('/api/leaderboard?scenario=v6-cloud', { method:'GET' });
                        if (!res.ok) throw new Error('HTTP ' + res.status);
                        const data = await res.json();
                        rows = Array.isArray(data) ? data : [];
                    } catch(e) {
                        const arr = JSON.parse(localStorage.getItem(key) || '[]');
                        rows = arr.map(x => ({ name: x.name, score: x.score, timestamp: x.timestamp }));
                    }

                    if (!rows.length) {
                        tbody.innerHTML = `<tr><td colspan="4">Henüz kayıt bulunmuyor.</td></tr>`;
                        return;
                    }
                    rows.sort((a,b)=> b.score - a.score);
                    tbody.innerHTML = rows.slice(0,50).map((r,i)=>`
                        <tr>
                            <td>${i+1}</td>
                            <td>${(r.name || 'Anonim').toString().slice(0,40)}</td>
                            <td>${r.score}</td>
                            <td>${r.timestamp ? new Date(r.timestamp).toLocaleString('tr-TR') : '-'}</td>
                        </tr>
                    `).join('');
                }
            };
            window.game.setup();
        });
    </script>
</body>
